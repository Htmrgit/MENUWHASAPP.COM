<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deepanshu Restaurant - Order Online</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom styles for the app */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding-top: 4rem; /* Space for fixed header (shorter header) */
            padding-bottom: 5rem; /* Space for fixed bottom navigation */
            background-color: #f9fafb; /* Light gray background */
            color: #1f2937; /* Dark text */
        }
        .dark body {
            background-color: #111827; /* Dark background */
            color: #f9fafb; /* Light text */
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        .header {
            background-color: #ffffff;
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            height: 4rem; /* Fixed height for header */
            display: flex;
            align-items: center;
        }
        .dark .header {
            background-color: #1f2937;
            border-bottom-color: #374151;
            box-shadow: 0 1px 3px 0 rgba(255, 255, 255, 0.1), 0 1px 2px 0 rgba(255, 255, 255, 0.06);
        }
        .mobile-menu-drawer {
            display: none;
            position: fixed; /* Keep it fixed */
            top: 4rem; /* Below the header */
            left: 0;
            width: 100%;
            height: calc(100% - 4rem - 5rem); /* Fill space between header and bottom nav */
            overflow-y: auto; /* Allow scrolling for long menus */
        }
        .mobile-menu-drawer.open {
            display: block;
        }

        /* Bottom Navigation Bar */
        .bottom-nav {
            background-color: #ffffff;
            border-top: 1px solid #e5e7eb;
            box-shadow: 0 -1px 3px 0 rgba(0, 0, 0, 0.1), 0 -1px 2px 0 rgba(0, 0, 0, 0.06);
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            display: flex;
            justify-content: space-around;
            padding: 0.5rem 0;
        }
        .dark .bottom-nav {
            background-color: #1f2937;
            border-top-color: #374151;
            box-shadow: 0 -1px 3px 0 rgba(255, 255, 255, 0.1), 0 -1px 2px 0 rgba(255, 255, 255, 0.06);
        }
        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease, color 0.2s ease;
            color: #6b7280; /* Gray 500 */
        }
        .dark .bottom-nav-item {
            color: #9ca3af; /* Gray 400 */
        }
        .bottom-nav-item.active {
            background-color: #fef2f2; /* Red 50 - subtle highlight */
            color: #ef4444; /* Red 500 */
        }
        .dark .bottom-nav-item.active {
            background-color: #450a0a; /* Red 900 - subtle highlight */
            color: #f87171; /* Red 400 */
        }
        .bottom-nav-item span:first-child { /* Icon */
            margin-bottom: 0.1rem;
        }
        .bottom-nav-item span:last-child { /* Text label */
            font-size: 0.75rem; /* text-xs */
            line-height: 1;
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 90%;
            width: 500px;
            transform: translateY(-20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .modal-overlay.open .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .dark .modal-content {
            background-color: #1f2937;
        }

        /* Category Modal Specific */
        #category-modal-content {
            max-height: 80vh; /* Limit height to prevent overflow on small screens */
            overflow-y: auto; /* Enable scrolling if categories exceed height */
        }
        .category-button-item {
            @apply flex items-center justify-between p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors cursor-pointer;
        }

        /* Toast Notifications (Add to Cart & General Info) */
        .app-toast {
            position: fixed;
            bottom: 6rem; /* Above bottom nav */
            left: 50%;
            transform: translateX(-50%);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px; /* Full rounded */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            z-index: 1100; /* Above bottom nav */
            text-align: center;
            min-width: 200px;
        }
        .app-toast.show {
            opacity: 1;
            visibility: visible;
        }
        .app-toast.success { background-color: rgba(34, 197, 94, 0.9); /* Green 500 */ }
        .app-toast.error { background-color: rgba(239, 68, 68, 0.9); /* Red 500 */ }
        .app-toast.info { background-color: rgba(59, 130, 246, 0.9); /* Blue 500 */ }
        .app-toast.warning { background-color: rgba(251, 191, 36, 0.9); /* Yellow 400 */ }


        /* Loading Spinner for Menu */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #f97316; /* Orange 500 */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        .dark .spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid #fb923c; /* Orange 400 */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Review Star Rating */
        .star-rating {
            display: inline-block;
            direction: rtl; /* For right-to-left star display */
        }
        .star-rating input[type="radio"] {
            display: none;
        }
        .star-rating label {
            font-size: 1.5rem; /* Adjust star size */
            color: #cbd5e1; /* Default gray star */
            cursor: pointer;
            padding: 0 0.1rem;
            transition: color 0.2s ease;
        }
        .star-rating input[type="radio"]:checked ~ label,
        .star-rating label:hover,
        .star-rating label:hover ~ label {
            color: #fbbf24; /* Yellow for selected/hovered stars */
        }
        /* Ensure stars fill from left for LTR display but logic is RTL */
        .star-rating label:hover ~ label {
            color: #fbbf24;
        }
        .star-rating:hover label {
            color: #cbd5e1; /* Reset on hover for entire group */
        }
        .star-rating input[type="radio"]:checked + label,
        .star-rating input[type="radio"]:checked + label ~ label {
            color: #fbbf24;
        }

        /* Confirmation Modal */
        #confirmation-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2500; /* Higher than other modals */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #confirmation-modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        #confirmation-modal-content {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 90%;
            width: 400px;
            transform: translateY(-20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            text-align: center;
        }
        #confirmation-modal-overlay.open #confirmation-modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .dark #confirmation-modal-content {
            background-color: #1f2937;
        }
    </style>
</head>
<body class="font-inter">
    <!-- Header -->
    <header class="header">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <!-- Restaurant Logo -->
                <img src="https://placehold.co/40x40/FF7F50/FFFFFF?text=D" alt="Restaurant Logo" class="rounded-full" />
                <!-- Restaurant Title -->
                <h1 class="text-xl md:text-2xl font-bold text-orange-600 dark:text-orange-500">Deepanshu Restaurant</h1>
            </div>

            <!-- Mobile Menu Button (visible only on mobile, desktop does not have top nav anymore) -->
            <button id="mobile-menu-button" class="md:hidden p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" aria-label="Toggle menu">
                <span data-lucide="menu" class="w-6 h-6" id="menu-icon"></span>
                <span data-lucide="x" class="w-6 h-6 hidden" id="close-icon"></span>
            </button>
        </div>

        <!-- Mobile Navigation Drawer -->
        <div id="mobile-menu-drawer" class="mobile-menu-drawer bg-white dark:bg-gray-800 pb-4 shadow-lg">
            <nav class="flex flex-col gap-2 px-4 py-4">
                <button class="nav-link flex items-center gap-2 px-4 py-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 active" data-page="menu">
                    <span data-lucide="book-open" class="w-5 h-5"></span>
                    <span>Menu</span>
                </button>
                <button class="nav-link flex items-center gap-2 px-4 py-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700" data-page="cart">
                    <span data-lucide="shopping-cart" class="w-5 h-5"></span>
                    <span>Cart (<span id="mobile-cart-item-count-drawer">0</span>)</span>
                </button>
                <button class="nav-link flex items-center gap-2 px-4 py-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700" data-page="order-history">
                    <span data-lucide="history" class="w-5 h-5"></span>
                    <span>Order History</span>
                </button>
                <button class="nav-link flex items-center gap-2 px-4 py-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700" data-page="review">
                    <span data-lucide="star" class="w-5 h-5"></span>
                    <span>Review</span>
                </button>
                <button class="nav-link flex items-center gap-2 px-4 py-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700" data-page="about">
                    <span data-lucide="info" class="w-5 h-5"></span>
                    <span>About</span>
                </button>
                <button class="nav-link flex items-center gap-2 px-4 py-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700" data-page="support">
                    <span data-lucide="message-square" class="w-5 h-5"></span>
                    <span>Support</span>
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="container mx-auto px-4 py-8">
        <!-- Menu Page -->
        <div id="menu-page" class="page-content active">
            <h2 class="text-3xl font-extrabold text-gray-800 dark:text-white mb-6 text-center">Our Delicious Menu</h2>
            <div class="flex flex-col sm:flex-row gap-4 mb-6">
                <input type="text" id="search-input" placeholder="Search menu items..." class="flex-grow shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200">
                <button id="category-button" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-50 flex items-center justify-center gap-2">
                    <span data-lucide="tag" class="w-5 h-5"></span>
                    Categories
                </button>
            </div>
            <div id="loading-spinner-container" class="flex justify-center items-center py-10 hidden">
                <div class="spinner"></div>
            </div>
            <div id="menu-items-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Menu items will be loaded here by JavaScript -->
                <p id="error-message" class="col-span-full text-center text-red-600 dark:text-red-400 hidden">Failed to load menu. Please try again later.</p>
            </div>
        </div>

        <!-- Cart Page -->
        <div id="cart-page" class="page-content hidden">
            <h2 class="text-3xl font-extrabold text-gray-800 dark:text-white mb-6 text-center">Your Cart</h2>
            <div id="cart-empty-message" class="text-center text-lg text-gray-600 dark:text-gray-300 hidden">
                Your cart is empty. Go to the <button class="text-orange-600 hover:underline" onclick="showPage('menu')">menu</button> to add some delicious food!
            </div>
            <div id="cart-content" class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 hidden">
                <div id="cart-items-list" class="space-y-4">
                    <!-- Cart items will be loaded here by JavaScript -->
                </div>
                <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center">
                    <span class="text-xl font-bold text-gray-800 dark:text-white">Total:</span>
                    <span id="cart-total" class="text-3xl font-extrabold text-orange-600 dark:text-orange-500">?0.00</span>
                </div>
                <div class="flex flex-col sm:flex-row gap-4 mt-8">
                    <button id="clear-cart-button" class="flex-grow bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 ease-in-out transform hover:-translate-y-1 hover:shadow-xl flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50">
                        <span data-lucide="trash-2" class="w-6 h-6"></span>
                        Clear Cart
                    </button>
                    <button id="place-order-button" class="flex-grow bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 ease-in-out transform hover:-translate-y-1 hover:shadow-xl flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp Icon" class="w-6 h-6" />
                        Place Order
                    </button>
                </div>
            </div>
        </div>

        <!-- Order History Page -->
        <div id="order-history-page" class="page-content hidden">
            <h2 class="text-3xl font-extrabold text-gray-800 dark:text-white mb-6 text-center">Your Order History</h2>
            <div id="order-history-list" class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
                <!-- Order history will be loaded here by JavaScript -->
                <p id="no-orders-message" class="text-center text-lg text-gray-600 dark:text-gray-300 hidden">You haven't placed any orders yet.</p>
            </div>
        </div>

        <!-- Review Page -->
        <div id="review-page" class="page-content hidden">
            <h2 class="text-3xl font-extrabold text-gray-800 dark:text-white mb-6 text-center">Customer Reviews</h2>
            
            <!-- Review Submission Section -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8 max-w-2xl mx-auto border border-gray-200 dark:border-gray-700">
                <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Leave a Review</h3>
                <div class="mb-4">
                    <label for="reviewer-name" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Your Name:</label>
                    <input type="text" id="reviewer-name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200" placeholder="e.g., Jane Doe">
                </div>
                <div class="mb-4">
                    <label for="review-text" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Your Review:</label>
                    <textarea id="review-text" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200" rows="4" placeholder="Share your experience..."></textarea>
                </div>
                <div class="mb-6 flex items-center">
                    <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mr-3">Rating:</label>
                    <div class="star-rating" id="review-star-rating">
                        <input type="radio" id="star5" name="rating" value="5" /><label for="star5" title="5 stars">?</label>
                        <input type="radio" id="star4" name="rating" value="4" /><label for="star4" title="4 stars">?</label>
                        <input type="radio" id="star3" name="rating" value="3" /><label for="star3" title="3 stars">?</label>
                        <input type="radio" id="star2" name="rating" value="2" /><label for="star2" title="2 stars">?</label>
                        <input type="radio" id="star1" name="rating" value="1" /><label for="star1" title="1 star">?</label>
                    </div>
                </div>
                <button id="submit-review-button" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 ease-in-out transform hover:-translate-y-1 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                    Submit Review
                </button>
            </div>

            <!-- Existing Reviews Section (will be dynamically loaded) -->
            <div id="existing-reviews-container" class="space-y-6 max-w-2xl mx-auto">
                <p id="no-reviews-message" class="text-center text-lg text-gray-600 dark:text-gray-300 hidden">No reviews yet. Be the first to leave one!</p>
                <!-- Reviews will be loaded here by JavaScript -->
            </div>
        </div>

        <!-- About Page -->
        <div id="about-page" class="page-content hidden">
            <h2 class="text-3xl font-extrabold text-gray-800 dark:text-white mb-6 text-center">About Us</h2>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 max-w-2xl mx-auto">
              <p class="text-lg text-gray-700 dark:text-gray-300 mb-4">
                Welcome to <span class="font-semibold text-orange-600">Deepanshu Restaurant</span>, where culinary excellence meets convenience! We are passionate about serving fresh, high-quality, and incredibly tasty food to our community.
              </p>
              <p class="text-lg text-gray-700 dark:text-gray-300 mb-4">
                Our journey began with a simple goal: to create a delightful dining experience, whether you're enjoying our food in the comfort of your home or on the go. We believe in using the finest ingredients, crafted with care by our experienced chefs.
              </p>
              <p class="text-lg text-gray-700 dark:text-gray-300">
                Thank you for choosing Deepanshu Restaurant. We look forward to serving you!
              </p>
            </div>
        </div>

        <!-- Support Page -->
        <div id="support-page" class="page-content hidden">
            <h2 class="text-3xl font-extrabold text-gray-800 dark:text-white mb-6 text-center">Support & Contact</h2>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 max-w-2xl mx-auto">
              <p class="text-lg text-gray-700 dark:text-gray-300 mb-4">
                Have questions or need assistance? Our support team is here to help you!
              </p>
              <ul class="text-left text-lg text-gray-700 dark:text-gray-300 space-y-3">
                <li>
                  <strong class="text-orange-600 dark:text-orange-500">Email:</strong>
                  <a href="mailto:support@deepanshurestaurant.com" class="text-blue-500 hover:underline">support@deepanshurestaurant.com</a>
                </li>
                <li>
                  <strong class="text-orange-600 dark:text-orange-500">Phone:</strong>
                  <a href="tel:+919910109626" class="text-blue-500 hover:underline">+91 99101 09626</a>
                </li>
                <li>
                  <strong class="text-orange-600 dark:text-orange-500">Address:</strong>
                  123 Food Street, Culinary City, India
                </li>
              </ul>
              <p class="mt-6 text-gray-600 dark:text-gray-400">
                We aim to respond to all inquiries within 24 hours.
              </p>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation Bar -->
    <nav class="bottom-nav">
        <button class="bottom-nav-item active" data-page="menu">
            <span data-lucide="home" class="w-6 h-6"></span>
            <span>Home</span>
        </button>
        <button class="bottom-nav-item" data-page="cart">
            <span data-lucide="shopping-cart" class="w-6 h-6"></span>
            <span>Cart (<span id="bottom-cart-item-count">0</span>)</span>
        </button>
        <button class="bottom-nav-item" data-page="order-history">
            <span data-lucide="history" class="w-6 h-6"></span>
            <span>Orders</span>
        </button>
        <button class="bottom-nav-item" data-page="review">
            <span data-lucide="star" class="w-6 h-6"></span>
            <span>Review</span>
        </button>
        <button class="bottom-nav-item" data-page="about">
            <span data-lucide="info" class="w-6 h-6"></span>
            <span>About</span>
        </button>
    </nav>


    <!-- Order Modal -->
    <div id="order-modal-overlay" class="modal-overlay">
        <div class="modal-content relative">
            <button id="close-modal-button" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                <span data-lucide="x" class="w-6 h-6"></span>
            </button>
            <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-6 text-center">Place Your Order</h3>

            <div class="mb-4">
                <label for="order-type" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Order Type:</label>
                <select id="order-type" class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200">
                    <option value="pickup">Pickup</option>
                    <option value="delivery">Delivery</option>
                </select>
            </div>

            <div class="mb-4">
                <label for="customer-name" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Your Name:</label>
                <input type="text" id="customer-name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200" placeholder="e.g., John Doe">
            </div>

            <div class="mb-4">
                <label for="customer-phone" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Phone Number:</label>
                <input type="tel" id="customer-phone" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200" placeholder="e.g., +919910109626">
            </div>

            <div id="delivery-address-group" class="mb-4 hidden">
                <label for="delivery-address" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Delivery Address:</label>
                <textarea id="delivery-address" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200" rows="3" placeholder="e.g., Flat 101, Apartment Name, Street, City"></textarea>
            </div>

            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                Your Order Number will be: <span id="order-number" class="font-bold text-orange-600 dark:text-orange-500"></span>
            </p>

            <button id="confirm-order-button" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 ease-in-out transform hover:-translate-y-1 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">
                Confirm Order & Send to WhatsApp
            </button>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="category-modal-overlay" class="modal-overlay">
        <div id="category-modal-content" class="modal-content relative">
            <button id="close-category-modal-button" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                <span data-lucide="x" class="w-6 h-6"></span>
            </button>
            <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-6 text-center">Select Category</h3>
            <div id="category-list" class="flex flex-col gap-2">
                <!-- Categories will be rendered here -->
            </div>
        </div>
    </div>

    <!-- General Info Toast (for success, error, info messages) -->
    <div id="info-toast" class="app-toast">
        <!-- Message will be inserted here -->
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal-overlay" class="modal-overlay">
        <div id="confirmation-modal-content" class="modal-content">
            <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4" id="confirmation-modal-title"></h3>
            <p class="text-gray-700 dark:text-gray-300 mb-6" id="confirmation-modal-message"></p>
            <div class="flex justify-center gap-4">
                <button id="confirm-yes-button" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-5 rounded-full shadow-md transition-colors">Yes</button>
                <button id="confirm-no-button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-5 rounded-full shadow-md transition-colors">No</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Global variables for managing state
        let cartItems = JSON.parse(localStorage.getItem('restaurantCartItems')) || [];
        let currentPage = 'menu'; // Default page
        let searchTerm = '';
        let selectedCategory = 'All'; // Default category
        let menuItems = []; // This will now be populated from Google Apps Script

        // IMPORTANT: This URL is from your deployed Google Apps Script for fetching menu
        const GOOGLE_APPS_SCRIPT_MENU_URL = 'https://script.google.com/macros/s/AKfycby-lPu5QxuUU7OPtCyJr29ezXMXcQEKush8wjBrTmc2_Yu6_K0RTuiRA3-momVpQpZI/exec';

        // IMPORTANT: Replace this with YOUR DEPLOYED GOOGLE APPS SCRIPT WEB APP URL for Reviews
        // This script will handle saving and fetching reviews from your Google Sheet.
        // See instructions below the code for how to set this up.
        const GOOGLE_SHEET_REVIEW_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwJAfCPxRQHR97Yk3jPiw1XjcXpSVu2B4uvuLABeHc6p7OOIQtApihkyAtmtOIl8nI/exec'; // <--- REPLACE THIS LINE!

        // --- DOM Elements ---
        const menuItemsContainer = document.getElementById('menu-items-container');
        const loadingSpinnerContainer = document.getElementById('loading-spinner-container');
        const errorMessage = document.getElementById('error-message');
        const cartItemsList = document.getElementById('cart-items-list');
        const cartTotalSpan = document.getElementById('cart-total');
        const mobileCartItemCountDrawer = document.getElementById('mobile-cart-item-count-drawer');
        const bottomCartItemCount = document.getElementById('bottom-cart-item-count');
        const cartEmptyMessage = document.getElementById('cart-empty-message');
        const cartContent = document.getElementById('cart-content');
        const placeOrderButton = document.getElementById('place-order-button');
        const clearCartButton = document.getElementById('clear-cart-button');
        const orderHistoryList = document.getElementById('order-history-list');
        const noOrdersMessage = document.getElementById('no-orders-message');
        const infoToast = document.getElementById('info-toast'); // General info toast

        // Mobile menu elements
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenuDrawer = document.getElementById('mobile-menu-drawer');
        const menuIcon = document.getElementById('menu-icon');
        const closeIcon = document.getElementById('close-icon');

        // Modal elements
        const orderModalOverlay = document.getElementById('order-modal-overlay');
        const closeModalButton = document.getElementById('close-modal-button');
        const orderTypeSelect = document.getElementById('order-type');
        const customerNameInput = document.getElementById('customer-name');
        const customerPhoneInput = document.getElementById('customer-phone');
        const deliveryAddressGroup = document.getElementById('delivery-address-group');
        const deliveryAddressInput = document.getElementById('delivery-address');
        const orderNumberSpan = document.getElementById('order-number');
        const confirmOrderButton = document.getElementById('confirm-order-button');

        // Search & Category elements
        const searchInput = document.getElementById('search-input');
        const categoryButton = document.getElementById('category-button');
        const categoryModalOverlay = document.getElementById('category-modal-overlay');
        const closeCategoryModalButton = document.getElementById('close-category-modal-button');
        const categoryList = document.getElementById('category-list');

        // Review Page elements
        const reviewerNameInput = document.getElementById('reviewer-name');
        const reviewTextInput = document.getElementById('review-text');
        const submitReviewButton = document.getElementById('submit-review-button');
        const reviewStarRating = document.getElementById('review-star-rating');
        const existingReviewsContainer = document.getElementById('existing-reviews-container');
        const noReviewsMessage = document.getElementById('no-reviews-message');

        // Confirmation Modal elements
        const confirmationModalOverlay = document.getElementById('confirmation-modal-overlay');
        const confirmationModalTitle = document.getElementById('confirmation-modal-title');
        const confirmationModalMessage = document.getElementById('confirmation-modal-message');
        const confirmYesButton = document.getElementById('confirm-yes-button');
        const confirmNoButton = document.getElementById('confirm-no-button');

        // --- Functions ---

        /**
         * Displays a custom toast message.
         * @param {string} message - The message to display.
         * @param {'success'|'error'|'info'|'warning'} type - The type of message for styling.
         * @param {number} duration - How long the toast should be visible in milliseconds.
         */
        function showToast(message, type = 'info', duration = 2000) {
            infoToast.textContent = message;
            infoToast.className = `app-toast show ${type}`; // Reset classes and add new ones
            setTimeout(() => {
                infoToast.classList.remove('show');
            }, duration);
        }

        /**
         * Shows a custom confirmation modal.
         * @param {string} title - The title of the confirmation.
         * @param {string} message - The message to display.
         * @returns {Promise<boolean>} Resolves with true if confirmed, false otherwise.
         */
        function showConfirmation(title, message) {
            return new Promise((resolve) => {
                confirmationModalTitle.textContent = title;
                confirmationModalMessage.textContent = message;
                confirmationModalOverlay.classList.add('open');

                const handleYes = () => {
                    confirmationModalOverlay.classList.remove('open');
                    confirmYesButton.removeEventListener('click', handleYes);
                    confirmNoButton.removeEventListener('click', handleNo);
                    resolve(true);
                };

                const handleNo = () => {
                    confirmationModalOverlay.classList.remove('open');
                    confirmYesButton.removeEventListener('click', handleYes);
                    confirmNoButton.removeEventListener('click', handleNo);
                    resolve(false);
                };

                confirmYesButton.addEventListener('click', handleYes);
                confirmNoButton.addEventListener('click', handleNo);

                // Close on overlay click
                const handleOverlayClick = (event) => {
                    if (event.target === confirmationModalOverlay) {
                        handleNo(); // Treat outside click as a "No"
                        confirmationModalOverlay.removeEventListener('click', handleOverlayClick);
                    }
                };
                confirmationModalOverlay.addEventListener('click', handleOverlayClick);
            });
        }


        /**
         * Fetches menu items from the Google Apps Script web app.
         */
        async function fetchMenuItems() {
            loadingSpinnerContainer.classList.remove('hidden'); // Show spinner
            menuItemsContainer.classList.add('hidden'); // Hide menu container while loading
            errorMessage.classList.add('hidden');
            menuItemsContainer.innerHTML = ''; // Clear existing content

            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_MENU_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                menuItems = data; // Populate global menuItems array
                
                loadingSpinnerContainer.classList.add('hidden'); // Hide spinner
                menuItemsContainer.classList.remove('hidden'); // Show menu container
                renderMenu(); // Render menu after data is fetched
            } catch (error) {
                console.error('Error fetching menu items:', error);
                loadingSpinnerContainer.classList.add('hidden'); // Hide spinner
                menuItemsContainer.classList.remove('hidden'); // Show menu container even with error
                errorMessage.classList.remove('hidden');
                menuItemsContainer.innerHTML = `<p class="col-span-full text-center text-red-600 dark:text-red-400">Error loading menu: ${error.message}. Please ensure Google Apps Script is deployed correctly and Spreadsheet ID is accurate.</p>`;
            }
        }


        /**
         * Renders the menu items to the DOM based on current search term and category.
         */
        function renderMenu() {
            menuItemsContainer.innerHTML = ''; // Clear existing items
            errorMessage.classList.add('hidden'); // Hide any previous error messages

            const filteredItems = menuItems.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                      item.description.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCategory = selectedCategory === 'All' || item.category === selectedCategory;
                return matchesSearch && matchesCategory;
            });

            if (filteredItems.length === 0) {
                menuItemsContainer.innerHTML = `<p class="text-center text-lg text-gray-600 dark:text-gray-300 col-span-full">No items found matching your criteria.</p>`;
                return;
            }

            filteredItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'bg-white dark:bg-gray-800 rounded-xl shadow-md p-5 flex flex-col items-center text-center transition-transform transform hover:scale-105';

                let priceDisplay = '';
                let addToCartButtonHTML = '';

                if (item.variants && item.variants.length > 0) {
                    // If item has variants, show a dropdown
                    priceDisplay = `<span class="text-lg font-bold text-gray-800 dark:text-white">From ?${Math.min(...item.variants.map(v => v.price)).toFixed(2)}</span>`;
                    const optionsHtml = item.variants.map((variant, index) =>
                        `<option value="${index}" data-price="${variant.price}">${variant.name} (?${variant.price.toFixed(2)})</option>`
                    ).join('');

                    addToCartButtonHTML = `
                        <select class="variant-select shadow border rounded py-1 px-2 text-gray-700 leading-tight focus:outline-none focus:shadow-outline dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 mb-2 w-full">
                            ${optionsHtml}
                        </select>
                        <button class="add-to-cart-button bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded-full shadow-lg transition-all duration-300 ease-in-out transform hover:-translate-y-1 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-50" data-item-id="${item.id}" data-is-variant="true">
                            <span data-lucide="shopping-cart" class="w-5 h-5 inline-block mr-1"></span> Add
                        </button>
                    `;
                } else {
                    // If no variants, show single price and direct add button
                    priceDisplay = `<span class="text-2xl font-bold text-orange-600 dark:text-orange-500">?${item.price.toFixed(2)}</span>`;
                    addToCartButtonHTML = `
                        <button class="add-to-cart-button bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded-full shadow-lg transition-all duration-300 ease-in-out transform hover:-translate-y-1 hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-50" data-item-id="${item.id}" data-is-variant="false">
                            <span data-lucide="shopping-cart" class="w-5 h-5 inline-block mr-1"></span> Add
                        </button>
                    `;
                }

                itemDiv.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="w-28 h-28 object-cover rounded-lg mb-4 border-2 border-orange-300 dark:border-orange-600 shadow-md" />
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-white mb-2">${item.name}</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-3 flex-grow">${item.description}</p>
                    <div class="flex flex-col items-center justify-between w-full mt-auto">
                        ${priceDisplay}
                        ${addToCartButtonHTML}
                    </div>
                `;
                menuItemsContainer.appendChild(itemDiv);
            });

            // Attach event listeners to "Add to Cart" buttons
            document.querySelectorAll('.add-to-cart-button').forEach(button => {
                button.addEventListener('click', (event) => {
                    const itemId = parseInt(event.currentTarget.dataset.itemId);
                    const isVariantItem = event.currentTarget.dataset.isVariant === 'true';
                    const itemData = menuItems.find(item => item.id === itemId);

                    if (isVariantItem && itemData.variants && itemData.variants.length > 0) {
                        const selectElement = event.currentTarget.previousElementSibling; // The select dropdown
                        const selectedVariantIndex = parseInt(selectElement.value);
                        const selectedVariant = itemData.variants[selectedVariantIndex];
                        addToCart({
                            id: itemData.id,
                            name: itemData.name,
                            variantName: selectedVariant.name,
                            price: selectedVariant.price,
                            image: itemData.image // Use original item's image
                        });
                    } else if (itemData) {
                        addToCart(itemData);
                    }
                });
            });
            lucide.createIcons(); // Re-render Lucide icons for newly added elements
        }

        /**
         * Adds an item (with or without variant) to the cart or increments its quantity.
         * @param {object} itemToAdd - The item object to add.
         * If it's a variant, it should have `variantName` and its `price`.
         */
        function addToCart(itemToAdd) {
            let existingItem;
            if (itemToAdd.variantName) {
                // For variant items, match by ID and variant name
                existingItem = cartItems.find(item => item.id === itemToAdd.id && item.variantName === itemToAdd.variantName);
            } else {
                // For non-variant items, match by ID
                existingItem = cartItems.find(item => item.id === itemToAdd.id);
            }

            if (existingItem) {
                existingItem.quantity++;
            } else {
                cartItems.push({ ...itemToAdd, quantity: 1 });
            }
            saveCartToLocalStorage();
            updateCartDisplay();
            showToast(`${itemToAdd.name} added to cart!`, 'success'); // Show success toast
        }

        /**
         * Updates the quantity of an item in the cart.
         * @param {number} itemId - The ID of the item to update.
         * @param {string|undefined} variantName - The name of the variant, or undefined for non-variant items.
         * @param {number} change - The change in quantity (-1 for decrement, 1 for increment).
         */
        function updateQuantity(itemId, variantName, change) {
            cartItems = cartItems.map(item => {
                const isMatch = item.id === itemId && (variantName ? item.variantName === variantName : !item.variantName);
                if (isMatch) {
                    return { ...item, quantity: Math.max(1, item.quantity + change) };
                }
                return item;
            }).filter(item => item.quantity > 0);
            saveCartToLocalStorage();
            updateCartDisplay();
        }

        /**
         * Removes an item completely from the cart.
         * @param {number} itemId - The ID of the item to remove.
         * @param {string|undefined} variantName - The name of the variant, or undefined for non-variant items.
         */
        function removeItem(itemId, variantName) {
            cartItems = cartItems.filter(item => {
                const isMatch = item.id === itemId && (variantName ? item.variantName === variantName : !item.variantName);
                return !isMatch;
            });
            saveCartToLocalStorage();
            updateCartDisplay();
            showToast('Item removed from cart.', 'info');
        }

        /**
         * Clears all items from the cart.
         */
        async function clearCart() {
            if (cartItems.length === 0) {
                showToast("Cart is already empty.", 'info');
                return;
            }

            const confirmed = await showConfirmation(
                "Clear Cart?",
                "Are you sure you want to clear all items from your cart?"
            );

            if (confirmed) {
                cartItems = [];
                saveCartToLocalStorage();
                updateCartDisplay();
                showToast("Cart cleared!", 'success');
            } else {
                showToast("Cart not cleared.", 'info');
            }
        }


        /**
         * Calculates the total price of all items in the cart.
         * @returns {string} The total price formatted to two decimal places.
         */
        function calculateTotal() {
            return cartItems.reduce((total, item) => total + (item.price * item.quantity), 0).toFixed(2);
        }

        /**
         * Saves the current cart items to local storage.
         */
        function saveCartToLocalStorage() {
            localStorage.setItem('restaurantCartItems', JSON.stringify(cartItems));
        }

        /**
         * Updates the cart display (items list, total, and item count).
         */
        function updateCartDisplay() {
            cartItemsList.innerHTML = ''; // Clear existing items
            if (cartItems.length === 0) {
                cartEmptyMessage.classList.remove('hidden');
                cartContent.classList.add('hidden');
            } else {
                cartEmptyMessage.classList.add('hidden');
                cartContent.classList.remove('hidden');
                cartItems.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'flex items-center justify-between border-b border-gray-200 dark:border-gray-700 pb-4 last:border-b-0';
                    const itemDisplayName = item.variantName ? `${item.name} (${item.variantName})` : item.name;
                    itemDiv.innerHTML = `
                        <div class="flex items-center gap-4">
                            <img src="${item.image}" alt="${item.name}" class="w-20 h-20 object-cover rounded-md border-2 border-gray-200 dark:border-gray-600" />
                            <div class="flex-grow">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-white">${itemDisplayName}</h3>
                                <p class="text-gray-600 dark:text-gray-300">?${item.price.toFixed(2)} each</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="flex items-center border border-gray-300 dark:border-gray-600 rounded-md">
                                <button class="quantity-button p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-l-md" data-item-id="${item.id}" data-variant-name="${item.variantName || ''}" data-change="-1" aria-label="Decrease quantity">
                                    -
                                </button>
                                <span class="px-3 py-1 text-gray-900 dark:text-gray-100">${item.quantity}</span>
                                <button class="quantity-button p-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-r-md" data-item-id="${item.id}" data-variant-name="${item.variantName || ''}" data-change="1" aria-label="Increase quantity">
                                    +
                                </button>
                            </div>
                            <button class="remove-item-button text-red-600 hover:text-red-800 dark:text-red-500 dark:hover:text-red-400 p-2 rounded-full hover:bg-red-50 dark:hover:bg-red-900 transition-colors" data-item-id="${item.id}" data-variant-name="${item.variantName || ''}" aria-label="Remove item">
                                <span data-lucide="x" class="w-5 h-5"></span>
                            </button>
                        </div>
                    `;
                    cartItemsList.appendChild(itemDiv);
                });

                // Attach event listeners to quantity buttons
                document.querySelectorAll('.quantity-button').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const itemId = parseInt(event.currentTarget.dataset.itemId);
                        const variantName = event.currentTarget.dataset.variantName || undefined;
                        const change = parseInt(event.currentTarget.dataset.change);
                        updateQuantity(itemId, variantName, change);
                    });
                });
                // Attach event listeners to remove buttons
                document.querySelectorAll('.remove-item-button').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const itemId = parseInt(event.currentTarget.dataset.itemId);
                        const variantName = event.currentTarget.dataset.variantName || undefined;
                        removeItem(itemId, variantName);
                    });
                });
            }
            cartTotalSpan.textContent = `?${calculateTotal()}`;
            // Update all cart count displays
            if (mobileCartItemCountDrawer) mobileCartItemCountDrawer.textContent = cartItems.length;
            if (bottomCartItemCount) bottomCartItemCount.textContent = cartItems.length;
            lucide.createIcons(); // Re-render Lucide icons for newly added elements
        }

        /**
         * Renders the order history from local storage.
         */
        function renderOrderHistory() {
            orderHistoryList.innerHTML = ''; // Clear existing orders
            const allOrders = JSON.parse(localStorage.getItem('restaurantOrders')) || [];

            if (allOrders.length === 0) {
                noOrdersMessage.classList.remove('hidden');
                return;
            } else {
                noOrdersMessage.classList.add('hidden');
            }

            // Sort orders by timestamp, newest first
            allOrders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            allOrders.forEach(order => {
                const orderDiv = document.createElement('div');
                orderDiv.className = 'border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-4 bg-white dark:bg-gray-700 shadow-sm';

                const orderDate = new Date(order.timestamp).toLocaleString();
                const itemsListHtml = order.items.map(item =>
                    `<li>${item.name}${item.variantName ? ` (${item.variantName})` : ''} x${item.quantity} - ?${(item.price * item.quantity).toFixed(2)}</li>`
                ).join('');

                orderDiv.innerHTML = `
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">${orderDate}</p>
                    <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-2">Order #${order.orderNumber}</h3>
                    <p class="text-gray-700 dark:text-gray-300 mb-1">Type: <span class="font-semibold">${order.customerInfo.orderType.charAt(0).toUpperCase() + order.customerInfo.orderType.slice(1)}</span></p>
                    <p class="text-gray-700 dark:text-gray-300 mb-3">Customer: <span class="font-semibold">${order.customerInfo.name}</span> (${order.customerInfo.phone})</p>
                    ${order.customerInfo.orderType === 'delivery' ? `<p class="text-gray-700 dark:text-gray-300 mb-3">Address: <span class="font-semibold">${order.customerInfo.address}</span></p>` : ''}
                    <h4 class="text-lg font-semibold text-gray-800 dark:text-white mt-4 mb-2">Items:</h4>
                    <ul class="list-disc list-inside text-gray-700 dark:text-gray-300 mb-3">
                        ${itemsListHtml}
                    </ul>
                    <div class="flex justify-between items-center border-t border-gray-200 dark:border-gray-600 pt-3 mt-3">
                        <span class="text-lg font-bold text-gray-800 dark:text-white">Total:</span>
                        <span class="text-2xl font-extrabold text-orange-600 dark:text-orange-500">?${order.total.toFixed(2)}</span>
                    </div>
                `;
                orderHistoryList.appendChild(orderDiv);
            });
        }

        /**
         * Shows the specified page and hides others.
         * @param {string} pageId - The ID of the page to show (e.g., 'menu', 'cart').
         */
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(`${pageId}-page`).classList.remove('hidden');

            // Update active navigation link styling for bottom nav
            document.querySelectorAll('.bottom-nav-item').forEach(link => {
                link.classList.remove('active', 'bg-red-50', 'text-red-500', 'dark:bg-red-900', 'dark:text-red-400');
                link.classList.add('text-gray-500', 'dark:text-gray-400');
                if (link.dataset.page === pageId) {
                    link.classList.add('active', 'bg-red-50', 'text-red-500');
                    link.classList.add('dark:bg-red-900', 'dark:text-red-400');
                }
            });

            // Ensure mobile drawer nav links also update if visible
            document.querySelectorAll('#mobile-menu-drawer .nav-link').forEach(link => {
                link.classList.remove('active', 'bg-orange-600', 'text-white', 'shadow-md', 'dark:bg-orange-700');
                link.classList.add('text-gray-700', 'hover:bg-gray-100', 'dark:text-gray-300', 'dark:hover:bg-gray-700');
                if (link.dataset.page === pageId) {
                    link.classList.add('active', 'bg-orange-600', 'text-white', 'shadow-md', 'dark:bg-orange-700');
                }
            });


            currentPage = pageId; // Update global current page state
            // Close mobile menu if open when navigating
            if (mobileMenuDrawer.classList.contains('open')) {
                toggleMobileMenu();
            }

            // If navigating to order history, render it
            if (pageId === 'order-history') {
                renderOrderHistory();
            }
            // If navigating to review, fetch and render reviews
            if (pageId === 'review') {
                fetchReviewsAndRender();
            }
        }

        /**
         * Toggles the mobile navigation menu visibility.
         */
        function toggleMobileMenu() {
            mobileMenuDrawer.classList.toggle('open');
            menuIcon.classList.toggle('hidden');
            closeIcon.classList.toggle('hidden');
        }

        /**
         * Generates a simple unique order number.
         * @returns {string} A unique order number.
         */
        function generateOrderNumber() {
            const timestamp = new Date().getTime();
            const random = Math.floor(Math.random() * 100000); // More random digits
            return `ORD-${timestamp.toString().slice(-8)}-${random.toString().padStart(5, '0')}`;
        }

        /**
         * Shows the order information modal.
         */
        function showOrderModal() {
            if (cartItems.length === 0) {
                showToast('Your cart is empty. Please add items before placing an order.', 'warning');
                return;
            }
            orderNumberSpan.textContent = generateOrderNumber(); // Generate and display order number
            orderModalOverlay.classList.add('open');
            // Clear previous inputs
            customerNameInput.value = '';
            customerPhoneInput.value = '';
            deliveryAddressInput.value = '';
            orderTypeSelect.value = 'pickup'; // Reset to pickup
            deliveryAddressGroup.classList.add('hidden'); // Hide address field initially
        }

        /**
         * Hides the order information modal.
         */
        function hideOrderModal() {
            orderModalOverlay.classList.remove('open');
        }

        /**
         * Confirms the order and sends details via WhatsApp.
         */
        async function confirmOrderAndSendWhatsApp() {
            const orderType = orderTypeSelect.value;
            const customerName = customerNameInput.value.trim();
            const customerPhone = customerPhoneInput.value.trim();
            const deliveryAddress = deliveryAddressInput.value.trim();
            const orderNumber = orderNumberSpan.textContent;

            // Basic validation
            if (!customerName || !customerPhone) {
                showToast('Please enter your name and phone number.', 'error');
                return;
            }
            if (orderType === 'delivery' && !deliveryAddress) {
                showToast('Please enter your delivery address.', 'error');
                return;
            }

            // Save order to local storage
            const order = {
                orderNumber: orderNumber,
                timestamp: new Date().toISOString(),
                customerInfo: {
                    name: customerName,
                    phone: customerPhone,
                    orderType: orderType,
                    address: orderType === 'delivery' ? deliveryAddress : 'N/A'
                },
                items: cartItems.map(item => ({
                    id: item.id,
                    name: item.name,
                    variantName: item.variantName || undefined, // Store variant name if present
                    quantity: item.quantity,
                    price: item.price
                })),
                total: parseFloat(calculateTotal())
            };

            let allOrders = JSON.parse(localStorage.getItem('restaurantOrders')) || [];
            allOrders.push(order);
            localStorage.setItem('restaurantOrders', JSON.stringify(allOrders));
            console.log('Order saved to local storage:', order);

            // Prepare WhatsApp message
            const restaurantNumber = '9910109626';
            let orderDetails = `*New Order - Deepanshu Restaurant*\n\n`; // Updated restaurant name
            orderDetails += `Order Number: *${orderNumber}*\n`;
            orderDetails += `Order Type: *${orderType.charAt(0).toUpperCase() + orderType.slice(1)}*\n`;
            orderDetails += `Customer Name: *${customerName}*\n`;
            orderDetails += `Phone: *${customerPhone}*\n`;
            if (orderType === 'delivery') {
                orderDetails += `Delivery Address: *${deliveryAddress}*\n`;
            }
            orderDetails += `\n*Order Details:*\n`;
            cartItems.forEach(item => {
                const itemDisplayName = item.variantName ? `${item.name} (${item.variantName})` : item.name;
                orderDetails += `- ${itemDisplayName} (x${item.quantity}) - ?${(item.price * item.quantity).toFixed(2)}\n`;
            });
            orderDetails += `\n*Total: ?${calculateTotal()}*\n\n`;
            orderDetails += `Thank you!`;

            const encodedMessage = encodeURIComponent(orderDetails);
            const whatsappUrl = `https://wa.me/${restaurantNumber}?text=${encodedMessage}`;

            window.open(whatsappUrl, '_blank');

            // Clear cart and close modal
            cartItems = [];
            saveCartToLocalStorage();
            updateCartDisplay();
            hideOrderModal();
            showToast('Order placed and sent to WhatsApp!', 'success');
            showPage('order-history'); // Redirect to order history after successful order
        }

        /**
         * Gets all unique categories from menu items.
         * @returns {string[]} An array of unique category names.
         */
        function getUniqueCategories() {
            const categories = new Set(menuItems.map(item => item.category).filter(Boolean));
            return ['All', ...Array.from(categories).sort()];
        }

        /**
         * Shows the category selection modal.
         */
        function showCategoryModal() {
            categoryList.innerHTML = ''; // Clear previous categories
            const categories = getUniqueCategories();

            categories.forEach(category => {
                const categoryButton = document.createElement('button');
                categoryButton.className = 'category-button-item text-gray-700 dark:text-gray-300';
                categoryButton.dataset.category = category;
                categoryButton.innerHTML = `
                    <span>${category}</span>
                    ${category === selectedCategory ? '<span data-lucide="check" class="text-green-500 w-5 h-5"></span>' : ''}
                `;
                categoryButton.addEventListener('click', () => {
                    filterByCategory(category);
                    hideCategoryModal();
                });
                categoryList.appendChild(categoryButton);
            });
            lucide.createIcons(); // Re-render Lucide icons for checkmark
            categoryModalOverlay.classList.add('open');
        }

        /**
         * Hides the category selection modal.
         */
        function hideCategoryModal() {
            categoryModalOverlay.classList.remove('open');
        }

        /**
         * Filters menu items by the selected category.
         * @param {string} category - The category to filter by.
         */
        function filterByCategory(category) {
            selectedCategory = category;
            renderMenu(); // Re-render menu with new filter
            searchInput.value = ''; // Clear search when category is selected
            searchTerm = ''; // Clear search term state
        }

        /**
         * Handles search input to filter menu items.
         */
        function handleSearchInput() {
            searchTerm = searchInput.value.trim();
            selectedCategory = 'All'; // Clear category selection when searching
            renderMenu(); // Re-render menu with new filter
        }

        /**
         * Fetches reviews from Google Sheet and renders them.
         */
        async function fetchReviewsAndRender() {
            existingReviewsContainer.innerHTML = ''; // Clear existing reviews
            noReviewsMessage.classList.add('hidden'); // Hide no reviews message by default

            if (GOOGLE_SHEET_REVIEW_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_FOR_REVIEWS') {
                // If not configured, show static reviews and a warning
                showToast("Google Apps Script URL for Reviews is not configured. Showing static reviews.", 'warning', 5000);
                renderStaticReviews(); // Render the hardcoded reviews if URL is not set
                return;
            }

            try {
                // Fetch reviews from the Google Apps Script Web App
                const response = await fetch(`${GOOGLE_SHEET_REVIEW_SCRIPT_URL}?action=getReviews`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                const reviews = data; // Assuming the script returns an array of review objects

                if (reviews.length === 0) {
                    noReviewsMessage.classList.remove('hidden');
                } else {
                    reviews.sort((a, b) => new Date(b.Timestamp) - new Date(a.Timestamp)); // Sort by timestamp, newest first
                    reviews.forEach(review => {
                        const reviewDiv = document.createElement('div');
                        reviewDiv.className = 'bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 border border-gray-200 dark:border-gray-700';

                        // Generate stars based on rating
                        let starsHtml = '';
                        for (let i = 1; i <= 5; i++) {
                            if (i <= review.Rating) {
                                starsHtml += `<span data-lucide="star" class="w-5 h-5 fill-current text-yellow-400"></span>`;
                            } else {
                                starsHtml += `<span data-lucide="star" class="w-5 h-5 text-yellow-400"></span>`;
                            }
                        }

                        const reviewDate = new Date(review.Timestamp).toLocaleString();

                        reviewDiv.innerHTML = `
                            <div class="flex items-center mb-3">
                                <span class="font-semibold text-lg text-gray-800 dark:text-white">${review.Name}</span>
                                <div class="flex ml-auto">
                                    ${starsHtml}
                                </div>
                            </div>
                            <p class="text-gray-700 dark:text-gray-300 mb-4">"${review.Review}"</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Reviewed on: ${reviewDate}</p>
                        `;
                        existingReviewsContainer.appendChild(reviewDiv);
                    });
                }
                lucide.createIcons(); // Re-render Lucide icons for stars
            } catch (error) {
                console.error("Error fetching reviews:", error);
                showToast(`Failed to load reviews: ${error.message}`, 'error', 5000);
                noReviewsMessage.classList.remove('hidden'); // Show no reviews message on error
                // Fallback to static reviews if fetching fails and no dynamic reviews were loaded
                renderStaticReviews();
            }
        }

        /**
         * Renders the hardcoded static reviews.
         * This function acts as a fallback or initial display if dynamic loading fails/isn't set up.
         */
        function renderStaticReviews() {
            existingReviewsContainer.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 border border-gray-200 dark:border-gray-700">
                    <div class="flex items-center mb-3">
                        <span class="font-semibold text-lg text-gray-800 dark:text-white">Aman K.</span>
                        <div class="flex ml-auto text-yellow-400">
                            <span data-lucide="star" class="w-5 h-5 fill-current"></span>
                            <span data-lucide="star" class="w-5 h-5 fill-current"></span>
                            <span data-lucide="star" class="w-5 h-5 fill-current"></span>
                            <span data-lucide="star" class="w-5 h-5 fill-current"></span>
                            <span data-lucide="star" class="w-5 h-5 fill-current"></span>
                        </div>
                    </div>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">
                        "Absolutely loved the food! The Margherita pizza was perfect, and the service was quick. Highly recommend!"
                    </p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Reviewed on: June 20, 2024</p>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 border border-gray-200 dark:border-gray-700">
                    <div class="flex items-center mb-3">
                        <span class="font-semibold text-lg text-gray-800 dark:text-white">Priya S.</span>
                        <div class="flex ml-auto text-yellow-400">
                            <span data-lucide="star" class="w-5 h-5 fill-current"></span>
                            <span data-lucide="star" class="w-5 h-5 fill-current"></span>
                            <span data-lucide="star" class="w-5 h-5 fill-current"></span>
                            <span data-lucide="star" class="w-5 h-5 fill-current"></span>
                            <span data-lucide="star-half" class="w-5 h-5 fill-current"></span>
                        </div>
                    </div>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">
                        "Great experience ordering from Deepanshu Restaurant. The Spaghetti Carbonara was rich and delicious. Will definitely order again."
                    </p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Reviewed on: June 18, 2024</p>
                </div>

                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 border border-gray-200 dark:border-gray-700">
                    <div class="flex items-center mb-3">
                        <span class="font-semibold text-lg text-gray-800 dark:text-white">Rahul M.</span>
                        <div class="flex ml-auto text-yellow-400">
                            <span data-lucide="star" class="w-5 h-5 fill-current"></span>
                            <span data-lucide="star" class="w-5 h-5 fill-current"></span>
                            <span data-lucide="star" class="w-5 h-5 fill-current"></span>
                            <span data-lucide="star" class="w-5 h-5 fill-current"></span>
                            <span data-lucide="star" class="w-5 h-5"></span>
                        </div>
                    </div>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">
                        "The Chicken Burger was juicy and flavorful. A fantastic option for a quick and tasty meal."
                    </p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Reviewed on: June 15, 2024</p>
                </div>
            `;
            lucide.createIcons(); // Re-render Lucide icons for stars
        }


        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            fetchMenuItems(); // Fetch menu items on page load
            updateCartDisplay();
            showPage('menu'); // Ensure menu page is shown on load

            // Bottom navigation buttons
            document.querySelectorAll('.bottom-nav-item').forEach(button => {
                button.addEventListener('click', (event) => {
                    showPage(event.currentTarget.dataset.page);
                });
            });

            // Mobile menu toggle (for the drawer)
            mobileMenuButton.addEventListener('click', toggleMobileMenu);

            // Navigation links inside mobile drawer
            document.querySelectorAll('#mobile-menu-drawer .nav-link').forEach(button => {
                button.addEventListener('click', (event) => {
                    showPage(event.currentTarget.dataset.page);
                });
            });

            // Place Order button in cart
            placeOrderButton.addEventListener('click', showOrderModal);

            // Clear Cart button
            clearCartButton.addEventListener('click', clearCart);

            // Modal close button for order modal
            closeModalButton.addEventListener('click', hideOrderModal);

            // Close order modal when clicking outside (on overlay)
            orderModalOverlay.addEventListener('click', (event) => {
                if (event.target === orderModalOverlay) {
                    hideOrderModal();
                }
            });

            // Order type selection in modal
            orderTypeSelect.addEventListener('change', (event) => {
                if (event.target.value === 'delivery') {
                    deliveryAddressGroup.classList.remove('hidden');
                } else {
                    deliveryAddressGroup.classList.add('hidden');
                }
            });

            // Confirm Order button in order modal
            confirmOrderButton.addEventListener('click', confirmOrderAndSendWhatsApp);

            // Search input event listener
            searchInput.addEventListener('input', handleSearchInput);

            // Category button event listener
            categoryButton.addEventListener('click', showCategoryModal);

            // Close category modal button
            closeCategoryModalButton.addEventListener('click', hideCategoryModal);

            // Close category modal when clicking outside (on overlay)
            categoryModalOverlay.addEventListener('click', (event) => {
                if (event.target === categoryModalOverlay) {
                    hideCategoryModal();
                }
            });

            // Submit Review Button
            submitReviewButton.addEventListener('click', async () => {
                const reviewerName = reviewerNameInput.value.trim();
                const reviewText = reviewTextInput.value.trim();
                const selectedRatingInput = document.querySelector('#review-star-rating input[name="rating"]:checked');
                const rating = selectedRatingInput ? parseInt(selectedRatingInput.value) : 0;

                if (!reviewerName || !reviewText || rating === 0) {
                    showToast('Please fill in your name, review, and select a rating before submitting.', 'warning');
                    return;
                }

                if (GOOGLE_SHEET_REVIEW_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_FOR_REVIEWS') {
                    showToast("Review submission is not configured. Please set up Google Apps Script URL.", 'error', 5000);
                    console.error("Google Apps Script URL for reviews is not configured. Cannot submit review.");
                    return;
                }

                submitReviewButton.disabled = true;
                submitReviewButton.textContent = 'Submitting...';
                submitReviewButton.classList.add('opacity-50', 'cursor-not-allowed');

                try {
                    const formData = new FormData();
                    formData.append('action', 'addReview');
                    formData.append('Name', reviewerName);
                    formData.append('Review', reviewText);
                    formData.append('Rating', rating);

                    const response = await fetch(GOOGLE_SHEET_REVIEW_SCRIPT_URL, {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();

                    if (result.status === 'success') {
                        showToast('Your review has been submitted successfully!', 'success');
                        reviewerNameInput.value = '';
                        reviewTextInput.value = '';
                        // Clear star selection by unchecking all radio buttons
                        document.querySelectorAll('#review-star-rating input[name="rating"]').forEach(input => input.checked = false);
                        lucide.createIcons(); // Re-render Lucide icons to reset star appearance
                        fetchReviewsAndRender(); // Refresh reviews to show the new one
                    } else {
                        throw new Error(result.message || 'Failed to submit review.');
                    }
                } catch (error) {
                    console.error('Error submitting review:', error);
                    showToast(`Failed to submit review: ${error.message}`, 'error');
                } finally {
                    submitReviewButton.disabled = false;
                    submitReviewButton.textContent = 'Submit Review';
                    submitReviewButton.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            });
        });
    </script>
</body>
</html>
